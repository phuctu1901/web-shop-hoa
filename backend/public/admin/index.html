<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BloomStore Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root {
      --bg-primary: #0a0c10;
      --bg-secondary: #12151c;
      --bg-card: #161a24;
      --bg-hover: #1e2230;
      --border: #232736;
      --text-primary: #f0f0f5;
      --text-secondary: #8b92a5;
      --accent: #8B4513;
      --accent-light: #A0522D;
      --accent-glow: rgba(139, 69, 19, 0.15);
      --success: #22c55e;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #3b82f6;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
    }

    /* Login */
    .login-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .login-box {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 3rem;
      width: 380px;
      text-align: center;
    }

    .login-box h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--accent-light);
    }

    .login-box p {
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-bottom: 2rem;
    }

    .login-box input {
      width: 100%;
      padding: 0.8rem 1rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.9rem;
      margin-bottom: 1rem;
      outline: none;
    }

    .login-box input:focus {
      border-color: var(--accent);
    }

    .login-box button {
      width: 100%;
      padding: 0.8rem;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }

    .login-box button:hover {
      opacity: 0.9;
    }

    .login-error {
      color: var(--danger);
      font-size: 0.85rem;
      margin-bottom: 1rem;
      display: none;
    }

    /* Layout */
    .app {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 240px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      padding: 1.5rem 0;
      position: fixed;
      top: 0;
      bottom: 0;
      overflow-y: auto;
    }

    .sidebar-logo {
      padding: 0 1.5rem;
      margin-bottom: 2rem;
    }

    .sidebar-logo h2 {
      color: var(--accent-light);
      font-size: 1.25rem;
    }

    .sidebar-logo small {
      color: var(--text-secondary);
      font-size: 0.75rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.5rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
      border-left: 3px solid transparent;
    }

    .nav-item:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: var(--accent-glow);
      color: var(--accent-light);
      border-left-color: var(--accent);
    }

    .nav-item i {
      width: 20px;
      text-align: center;
    }

    .nav-divider {
      height: 1px;
      background: var(--border);
      margin: 1rem 1.5rem;
    }

    .main {
      flex: 1;
      margin-left: 240px;
      padding: 2rem;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .page-header h1 {
      font-size: 1.5rem;
      font-weight: 600;
    }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.25rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .stat-card .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.75rem;
      font-size: 1.1rem;
    }

    .stat-card .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .stat-card .stat-label {
      color: var(--text-secondary);
      font-size: 0.82rem;
    }

    /* Table */
    .data-table {
      width: 100%;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
    }

    .data-table th {
      background: var(--bg-secondary);
      padding: 0.9rem 1rem;
      text-align: left;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .data-table td {
      padding: 0.9rem 1rem;
      border-top: 1px solid var(--border);
      font-size: 0.875rem;
      vertical-align: middle;
    }

    .data-table tr:hover td {
      background: var(--bg-hover);
    }

    .data-table img {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      object-fit: cover;
    }

    /* Btns */
    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      font-size: 0.82rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color: white;
    }

    .btn-primary:hover {
      opacity: 0.85;
    }

    .btn-sm {
      padding: 0.35rem 0.7rem;
      font-size: 0.78rem;
    }

    .btn-edit {
      background: var(--info);
      color: white;
    }

    .btn-delete {
      background: var(--danger);
      color: white;
    }

    .btn-edit:hover,
    .btn-delete:hover {
      opacity: 0.85;
    }

    /* Badge */
    .badge {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-success {
      background: rgba(34, 197, 94, 0.15);
      color: var(--success);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
    }

    .badge-info {
      background: rgba(59, 130, 246, 0.15);
      color: var(--info);
    }

    /* Stars */
    .stars {
      color: #f0c040;
      font-size: 0.8rem;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      backdrop-filter: blur(4px);
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      width: 600px;
      max-height: 85vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .modal-header h3 {
      font-size: 1.1rem;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.2rem;
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
    }

    /* Form */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-group label {
      display: block;
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.4rem;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.7rem 0.9rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.875rem;
      outline: none;
      font-family: inherit;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      border-color: var(--accent);
    }

    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    /* Upload zone */
    .upload-zone {
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--bg-secondary);
    }

    .upload-zone:hover,
    .upload-zone.drag-over {
      border-color: var(--accent);
      background: var(--accent-glow);
    }

    .upload-zone i {
      font-size: 2rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
      display: block;
    }

    .upload-zone p {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .upload-zone p em {
      color: var(--accent-light);
    }

    .upload-zone input[type=file] {
      display: none;
    }

    .upload-progress {
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: var(--accent-light);
    }

    .image-preview-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .image-preview-item {
      position: relative;
      width: 100px;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .image-preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .image-preview-item .remove-img {
      position: absolute;
      top: 2px;
      right: 2px;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 0.65rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .image-preview-item .img-badge {
      position: absolute;
      bottom: 2px;
      left: 2px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 0.6rem;
      padding: 1px 4px;
      border-radius: 4px;
    }

    .seo-section {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
    }

    .seo-section h4 {
      font-size: 0.85rem;
      color: var(--accent-light);
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .seo-preview {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.75rem;
      margin-top: 0.75rem;
    }

    .seo-preview .seo-title {
      color: #8ab4f8;
      font-size: 0.9rem;
    }

    .seo-preview .seo-url {
      color: #bdc1c6;
      font-size: 0.75rem;
      margin: 2px 0;
    }

    .seo-preview .seo-desc {
      color: #bdc1c6;
      font-size: 0.8rem;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 0.8rem 1.5rem;
      border-radius: 10px;
      color: white;
      font-size: 0.875rem;
      z-index: 200;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .toast.show {
      opacity: 1;
    }

    .toast-success {
      background: var(--success);
    }

    .toast-error {
      background: var(--danger);
    }

    /* Page sections */
    .page-section {
      display: none;
    }

    .page-section.active {
      display: block;
    }

    .format-price::before {
      content: '‚Ç´';
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .empty-state i {
      font-size: 2rem;
      margin-bottom: 0.75rem;
      display: block;
      opacity: 0.5;
    }

    /* Settings form */
    .settings-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    .settings-group {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .settings-group h3 {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--accent-light);
    }

    .settings-group h3 i {
      width: 20px;
      text-align: center;
    }

    .settings-group .form-group {
      margin-bottom: 1rem;
    }

    .settings-group .form-group:last-child {
      margin-bottom: 0;
    }

    .settings-actions {
      margin-top: 1.5rem;
      display: flex;
      justify-content: flex-end;
    }

    @media (max-width:900px) {
      .settings-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Logout */
    .nav-bottom {
      position: absolute;
      bottom: 1rem;
      left: 0;
      right: 0;
    }

    /* ===== TOP BAR ===== */
    .top-bar {
      height: 60px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2rem;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .top-bar-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .top-bar-left .page-breadcrumb {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .top-bar-left .page-breadcrumb span {
      color: var(--text-primary);
      font-weight: 600;
    }

    .sidebar-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.2rem;
      cursor: pointer;
      padding: 6px;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .sidebar-toggle:hover {
      color: var(--text-primary);
      background: var(--bg-hover);
    }

    .top-bar-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .top-search {
      position: relative;
    }

    .top-search input {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 0.5rem 0.8rem 0.5rem 2.2rem;
      border-radius: 10px;
      font-size: 0.82rem;
      width: 220px;
      transition: all 0.3s;
    }

    .top-search input:focus {
      border-color: var(--accent);
      width: 280px;
      outline: none;
      box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.15);
    }

    .top-search i {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 0.8rem;
    }

    .top-bar-btn {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--bg-primary);
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      transition: all 0.2s;
    }

    .top-bar-btn:hover {
      color: var(--text-primary);
      border-color: var(--accent);
    }

    .top-bar-btn .notif-dot {
      position: absolute;
      top: 6px;
      right: 6px;
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #ef4444;
    }

    .user-dropdown {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.35rem 0.5rem 0.35rem 0.35rem;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
    }

    .user-dropdown:hover {
      background: var(--bg-hover);
      border-color: var(--border);
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      color: white;
    }

    .user-dropdown span {
      font-size: 0.82rem;
      color: var(--text-primary);
      font-weight: 500;
    }

    .user-dropdown small {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    /* ===== IMPROVED SIDEBAR ===== */
    .sidebar.collapsed {
      width: 70px;
    }

    .sidebar.collapsed .sidebar-logo h2 span,
    .sidebar.collapsed .sidebar-logo small,
    .sidebar.collapsed .nav-item span,
    .sidebar.collapsed .nav-badge {
      display: none;
    }

    .sidebar.collapsed .sidebar-logo h2 {
      font-size: 1.5rem;
    }

    .sidebar.collapsed .nav-item {
      justify-content: center;
      padding: 0.85rem;
    }

    .sidebar.collapsed+.main {
      margin-left: 70px;
    }

    .nav-item {
      position: relative;
      border-radius: 0 12px 12px 0;
      margin-right: 12px;
    }

    .nav-item.active {
      background: linear-gradient(90deg, rgba(139, 69, 19, 0.2), transparent) !important;
      color: var(--accent-light) !important;
    }

    .nav-item.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 15%;
      bottom: 15%;
      width: 3px;
      border-radius: 0 3px 3px 0;
      background: linear-gradient(to bottom, var(--accent), var(--accent-light));
    }

    .nav-badge {
      background: #ef4444;
      color: white;
      font-size: 0.65rem;
      padding: 2px 6px;
      border-radius: 10px;
      margin-left: auto;
      font-weight: 600;
      min-width: 20px;
      text-align: center;
    }

    /* ===== IMPROVED STAT CARDS ===== */
    .stat-card {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      border-color: rgba(139, 69, 19, 0.3);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .stat-card .stat-trend {
      font-size: 0.72rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 2px;
      padding: 2px 8px;
      border-radius: 6px;
      margin-left: 0.5rem;
    }

    .stat-trend.up {
      background: rgba(34, 197, 94, 0.12);
      color: #22c55e;
    }

    .stat-trend.down {
      background: rgba(239, 68, 68, 0.12);
      color: #ef4444;
    }

    .stat-card .sparkline {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 50%;
      height: 40px;
      opacity: 0.15;
    }

    .stat-card .sparkline svg {
      width: 100%;
      height: 100%;
    }

    /* ===== WELCOME HEADER ===== */
    .welcome-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.75rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, var(--bg-card), rgba(139, 69, 19, 0.08));
      border: 1px solid var(--border);
      border-radius: 16px;
    }

    .welcome-text h1 {
      font-size: 1.35rem;
      margin: 0 0 0.3rem;
      color: var(--text-primary);
    }

    .welcome-text p {
      font-size: 0.85rem;
      margin: 0;
      color: var(--text-secondary);
    }

    .quick-actions {
      display: flex;
      gap: 0.6rem;
    }

    .quick-actions .btn {
      font-size: 0.8rem;
    }

    /* ===== TABLE SEARCH ===== */
    .table-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .table-search {
      position: relative;
    }

    .table-search input {
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 0.55rem 0.9rem 0.55rem 2.3rem;
      border-radius: 10px;
      font-size: 0.85rem;
      width: 260px;
      transition: all 0.25s;
    }

    .table-search input:focus {
      border-color: var(--accent);
      outline: none;
      box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.12);
    }

    .table-search i {
      position: absolute;
      left: 0.8rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 0.82rem;
    }

    .table-count {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* ===== PAGE TRANSITIONS ===== */
    .page-section {
      animation: fadeSlideIn 0.3s ease;
    }

    @keyframes fadeSlideIn {
      from {
        opacity: 0;
        transform: translateY(8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== IMPROVED LOGIN ===== */
    .login-overlay {
      background: linear-gradient(135deg, #0a0c10 0%, #1a1225 50%, #0f1117 100%) !important;
    }

    .login-overlay::before {
      content: '';
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(ellipse at 30% 20%, rgba(139, 69, 19, 0.08), transparent 60%),
        radial-gradient(ellipse at 70% 80%, rgba(139, 69, 19, 0.05), transparent 60%);
    }

    .login-box {
      border: 1px solid rgba(139, 69, 19, 0.2) !important;
      box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5), 0 0 80px rgba(139, 69, 19, 0.05) !important;
    }

    /* ===== SCROLLBAR ===== */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent);
    }
  </style>
</head>

<body>

  <!-- Login -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-box">
      <h1><i class="fas fa-leaf"></i> BloomStore</h1>
      <p>Admin Dashboard</p>
      <div class="login-error" id="loginError">Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u</div>
      <input type="text" id="loginUsername" placeholder="T√™n ƒëƒÉng nh·∫≠p" value="admin">
      <input type="password" id="loginPassword" placeholder="M·∫≠t kh·∫©u">
      <button onclick="doLogin()">ƒêƒÉng nh·∫≠p</button>
    </div>
  </div>

  <!-- App -->
  <div class="app" id="app" style="display:none">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <h2><i class="fas fa-leaf"></i> <span>BloomStore</span></h2>
        <small>Admin Panel</small>
      </div>
      <div class="nav-item active" onclick="showPage('dashboard')"><i class="fas fa-chart-pie"></i>
        <span>Dashboard</span>
      </div>
      <div class="nav-item" onclick="showPage('products')"><i class="fas fa-box"></i> <span>S·∫£n ph·∫©m</span></div>
      <div class="nav-item" onclick="showPage('categories')"><i class="fas fa-tags"></i> <span>Danh m·ª•c</span></div>
      <div class="nav-item" onclick="showPage('reviews')"><i class="fas fa-star"></i> <span>ƒê√°nh gi√°</span> <span
          class="nav-badge" id="reviewBadge" style="display:none">0</span></div>
      <div class="nav-divider"></div>
      <div class="nav-item" onclick="showPage('gallery')"><i class="fas fa-images"></i> <span>B·ªô s∆∞u t·∫≠p</span></div>
      <div class="nav-item" onclick="showPage('settings')"><i class="fas fa-cog"></i> <span>C√†i ƒë·∫∑t</span></div>
      <div class="nav-item" onclick="showPage('password')"><i class="fas fa-lock"></i> <span>ƒê·ªïi m·∫≠t kh·∫©u</span></div>
      <div class="nav-item" onclick="window.open('/api/docs','_blank')"><i class="fas fa-book"></i> <span>API
          Docs</span></div>
      <div class="nav-bottom">
        <div class="nav-item" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> <span>ƒêƒÉng xu·∫•t</span></div>
      </div>
    </aside>

    <main class="main">

      <!-- Top Bar -->
      <div class="top-bar">
        <div class="top-bar-left">
          <button class="sidebar-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
          <div class="page-breadcrumb">Qu·∫£n l√Ω / <span id="currentPageTitle">Dashboard</span></div>
        </div>
        <div class="top-bar-right">
          <div class="top-search">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="T√¨m ki·∫øm..." id="globalSearch">
          </div>
          <button class="top-bar-btn" title="Th√¥ng b√°o">
            <i class="fas fa-bell"></i>
            <span class="notif-dot"></span>
          </button>
          <button class="top-bar-btn" title="Xem trang ch·ªß" onclick="window.open('/','_blank')">
            <i class="fas fa-external-link-alt"></i>
          </button>
          <div class="user-dropdown" onclick="doLogout()">
            <div class="user-avatar">AD</div>
            <div style="line-height:1.2">
              <span>Admin</span><br>
              <small>Qu·∫£n tr·ªã vi√™n</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Dashboard -->
      <div class="page-section active" id="page-dashboard">
        <div class="welcome-section">
          <div class="welcome-text">
            <h1>üëã Xin ch√†o, Admin!</h1>
            <p id="welcomeDate">H√¥m nay l√† th·ª©...</p>
          </div>
          <div class="quick-actions">
            <button class="btn btn-primary" onclick="showPage('products'); openProductModal()"><i
                class="fas fa-plus"></i> Th√™m s·∫£n ph·∫©m</button>
            <button class="btn"
              style="background:var(--bg-secondary);color:var(--text-secondary);border:1px solid var(--border)"
              onclick="window.open('/','_blank')"><i class="fas fa-eye"></i> Xem shop</button>
          </div>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon" style="background:rgba(139,69,19,0.15);color:var(--accent-light)"><i
                class="fas fa-box"></i></div>
            <div class="stat-value" id="statProducts">0</div>
            <div class="stat-label">S·∫£n ph·∫©m <span class="stat-trend up"><i class="fas fa-arrow-up"></i> 12%</span>
            </div>
            <div class="sparkline"><svg viewBox="0 0 100 30" preserveAspectRatio="none">
                <polyline fill="none" stroke="rgba(139,69,19,0.6)" stroke-width="2"
                  points="0,25 15,20 30,22 45,15 60,18 75,10 100,5" />
              </svg></div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background:rgba(59,130,246,0.15);color:var(--info)"><i
                class="fas fa-tags"></i></div>
            <div class="stat-value" id="statCategories">0</div>
            <div class="stat-label">Danh m·ª•c</div>
            <div class="sparkline"><svg viewBox="0 0 100 30" preserveAspectRatio="none">
                <polyline fill="none" stroke="rgba(59,130,246,0.6)" stroke-width="2"
                  points="0,20 20,18 40,22 60,15 80,12 100,10" />
              </svg></div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background:rgba(245,158,11,0.15);color:var(--warning)"><i
                class="fas fa-star"></i></div>
            <div class="stat-value" id="statReviews">0</div>
            <div class="stat-label">ƒê√°nh gi√° <span class="stat-trend up"><i class="fas fa-arrow-up"></i> 8%</span></div>
            <div class="sparkline"><svg viewBox="0 0 100 30" preserveAspectRatio="none">
                <polyline fill="none" stroke="rgba(245,158,11,0.6)" stroke-width="2"
                  points="0,28 20,20 40,25 60,15 80,18 100,8" />
              </svg></div>
          </div>
          <div class="stat-card">
            <div class="stat-icon" style="background:rgba(34,197,94,0.15);color:var(--success)"><i
                class="fas fa-dollar-sign"></i></div>
            <div class="stat-value" id="statAvgPrice">0</div>
            <div class="stat-label">Gi√° TB (‚Ç´) <span class="stat-trend down"><i class="fas fa-arrow-down"></i> 3%</span>
            </div>
            <div class="sparkline"><svg viewBox="0 0 100 30" preserveAspectRatio="none">
                <polyline fill="none" stroke="rgba(34,197,94,0.6)" stroke-width="2"
                  points="0,10 20,15 40,12 60,20 80,18 100,22" />
              </svg></div>
          </div>
        </div>
        <h2 style="font-size:1.1rem;margin-bottom:1rem">S·∫£n ph·∫©m m·ªõi nh·∫•t</h2>
        <table class="data-table">
          <thead>
            <tr>
              <th>H√¨nh</th>
              <th>T√™n</th>
              <th>Danh m·ª•c</th>
              <th>Gi√°</th>
              <th>ƒê√°nh gi√°</th>
            </tr>
          </thead>
          <tbody id="dashboardProducts"></tbody>
        </table>
      </div>

      <!-- Products -->
      <div class="page-section" id="page-products">
        <div class="page-header">
          <h1>S·∫£n ph·∫©m</h1>
          <button class="btn btn-primary" onclick="openProductModal()"><i class="fas fa-plus"></i> Th√™m s·∫£n
            ph·∫©m</button>
        </div>
        <div class="table-toolbar">
          <div class="table-search">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="T√¨m s·∫£n ph·∫©m..." id="productSearch" oninput="filterProducts()">
          </div>
          <div class="table-count" id="productCount"></div>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>H√¨nh</th>
              <th>T√™n</th>
              <th>Danh m·ª•c</th>
              <th>Gi√°</th>
              <th>Gi√° g·ªëc</th>
              <th>Badge</th>
              <th>ƒê√°nh gi√°</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody id="productsTable"></tbody>
        </table>
      </div>

      <!-- Categories -->
      <div class="page-section" id="page-categories">
        <div class="page-header">
          <h1>Danh m·ª•c</h1>
          <button class="btn btn-primary" onclick="openCategoryModal()"><i class="fas fa-plus"></i> Th√™m danh
            m·ª•c</button>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Slug</th>
              <th>T√™n</th>
              <th>M√¥ t·∫£</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody id="categoriesTable"></tbody>
        </table>
      </div>

      <!-- Reviews -->
      <div class="page-section" id="page-reviews">
        <div class="page-header">
          <h1>ƒê√°nh gi√°</h1>
        </div>
        <div class="table-toolbar">
          <div class="table-search">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="T√¨m ƒë√°nh gi√°..." id="reviewSearch" oninput="filterReviews()">
          </div>
          <div class="table-count" id="reviewCount"></div>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>S·∫£n ph·∫©m</th>
              <th>Ng∆∞·ªùi ƒë√°nh gi√°</th>
              <th>ƒêi·ªÉm</th>
              <th>B√¨nh lu·∫≠n</th>
              <th>Ng√†y</th>
              <th>Thao t√°c</th>
            </tr>
          </thead>
          <tbody id="reviewsTable"></tbody>
        </table>
      </div>

      <!-- Gallery -->
      <div class="page-section" id="page-gallery">
        <div class="page-header">
          <h1>B·ªô s∆∞u t·∫≠p ·∫£nh</h1>
        </div>
        <div class="empty-state">
          <i class="fas fa-images"></i>
          Qu·∫£n l√Ω b·ªô s∆∞u t·∫≠p ·∫£nh qua API
        </div>
      </div>

      <!-- Settings -->
      <div class="page-section" id="page-settings">
        <div class="page-header">
          <h1>C√†i ƒë·∫∑t</h1>
          <button class="btn btn-primary" onclick="saveSettings()"><i class="fas fa-save"></i> L∆∞u thay ƒë·ªïi</button>
        </div>
        <div class="settings-grid">
          <div class="settings-group">
            <h3><i class="fas fa-store"></i> Th√¥ng tin c·ª≠a h√†ng</h3>
            <div class="form-group"><label>T√™n c·ª≠a h√†ng</label><input id="setting_shop_name"></div>
            <div class="form-group"><label>Slogan</label><input id="setting_slogan"></div>
            <div class="form-group"><label>Logo URL</label><input id="setting_logo_url" placeholder="https://..."></div>
            <div class="form-group"><label>Favicon URL</label><input id="setting_favicon_url" placeholder="https://...">
            </div>
          </div>
          <div class="settings-group">
            <h3><i class="fas fa-search"></i> SEO / Meta Tags</h3>
            <div class="form-group"><label>Meta Title</label><input id="setting_meta_title"></div>
            <div class="form-group"><label>Meta Description</label><textarea id="setting_meta_description"
                rows="3"></textarea></div>
            <div class="form-group"><label>Meta Keywords</label><input id="setting_meta_keywords"
                placeholder="t·ª´ kh√≥a 1, t·ª´ kh√≥a 2, ..."></div>
            <div class="form-group"><label>OG Image URL (chia s·∫ª m·∫°ng x√£ h·ªôi)</label><input id="setting_og_image"
                placeholder="https://..."></div>
          </div>
          <div class="settings-group">
            <h3><i class="fas fa-phone"></i> Li√™n h·ªá</h3>
            <div class="form-group"><label>S·ªë ƒëi·ªán tho·∫°i</label><input id="setting_phone"></div>
            <div class="form-group"><label>Email</label><input id="setting_email" type="email"></div>
            <div class="form-group"><label>ƒê·ªãa ch·ªâ</label><input id="setting_address"></div>
            <div class="form-group"><label>Google Map Embed URL</label><input id="setting_google_map_url"
                placeholder="https://www.google.com/maps/embed?pb=..."></div>
          </div>
          <div class="settings-group">
            <h3><i class="fas fa-share-alt"></i> M·∫°ng x√£ h·ªôi</h3>
            <div class="form-group"><label>Zalo URL</label><input id="setting_zalo_url"
                placeholder="https://zalo.me/..."></div>
            <div class="form-group"><label>Facebook URL</label><input id="setting_facebook_url"
                placeholder="https://facebook.com/..."></div>
            <div class="form-group"><label>Instagram URL</label><input id="setting_instagram_url"
                placeholder="https://instagram.com/..."></div>
          </div>
        </div>
      </div>

      <!-- Change Password Page -->
      <div class="page-section" id="page-password">
        <div class="page-header">
          <h1>ƒê·ªïi m·∫≠t kh·∫©u</h1>
        </div>
        <div class="settings-grid">
          <div class="settings-group">
            <h3><i class="fas fa-lock"></i> ƒê·ªïi m·∫≠t kh·∫©u qu·∫£n tr·ªã</h3>
            <div class="form-group"><label>M·∫≠t kh·∫©u hi·ªán t·∫°i</label><input id="currentPassword" type="password"
                placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i"></div>
            <div class="form-group"><label>M·∫≠t kh·∫©u m·ªõi</label><input id="newPassword" type="password"
                placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±"></div>
            <div class="form-group"><label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label><input id="confirmPassword" type="password"
                placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi"></div>
            <button class="btn btn-primary" onclick="changePassword()" style="margin-top:1rem"><i
                class="fas fa-save"></i> ƒê·ªïi m·∫≠t kh·∫©u</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Product Modal -->
  <div class="modal-overlay" id="productModal">
    <div class="modal" style="width:700px">
      <div class="modal-header">
        <h3 id="productModalTitle">Th√™m s·∫£n ph·∫©m</h3>
        <button class="modal-close" onclick="closeModal('productModal')">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="productId">
        <div class="form-group"><label>T√™n s·∫£n ph·∫©m</label><input id="productName"></div>
        <div class="form-row">
          <div class="form-group"><label>Danh m·ª•c</label><select id="productCategory"></select></div>
          <div class="form-group"><label>Badge</label><input id="productBadge" placeholder="VD: B√°n ch·∫°y, Premium">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Gi√° (‚Ç´)</label><input type="number" id="productPrice"></div>
          <div class="form-group"><label>Gi√° g·ªëc (‚Ç´)</label><input type="number" id="productOriginalPrice"></div>
        </div>
        <div class="form-group"><label>M√¥ t·∫£ ng·∫Øn</label><input id="productShortDesc"></div>
        <div class="form-group"><label>M√¥ t·∫£ chi ti·∫øt</label><textarea id="productLongDesc"></textarea></div>

        <!-- Image Upload Zone -->
        <div class="form-group">
          <label>H√¨nh ·∫£nh s·∫£n ph·∫©m <small style="color:var(--text-secondary)">(t·ª± ƒë·ªông chuy·ªÉn sang WebP cho
              SEO)</small></label>
          <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
            <input type="file" id="fileInput" multiple accept="image/*">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>K√©o th·∫£ ·∫£nh v√†o ƒë√¢y ho·∫∑c <em>nh·∫•p ƒë·ªÉ ch·ªçn</em></p>
            <p><small>JPG, PNG, WebP ‚Ä¢ T·ª± ƒë·ªông t·ªëi ∆∞u h√≥a WebP</small></p>
            <div class="upload-progress" id="uploadProgress"></div>
          </div>
          <div class="image-preview-list" id="imagePreviewList"></div>
        </div>

        <div class="form-group"><label>ƒê·∫∑c ƒëi·ªÉm (m·ªói d√≤ng 1 m·ª•c)</label><textarea id="productFeatures"></textarea></div>
        <div class="form-group"><label>D·ªãp ph√π h·ª£p (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y)</label><input id="productOccasions"
            placeholder="ƒê√°m c∆∞·ªõi, Sinh nh·∫≠t"></div>

        <!-- SEO Section -->
        <div class="seo-section">
          <h4><i class="fas fa-search"></i> SEO / Metadata</h4>
          <div class="form-group"><label>Slug (URL)</label><input id="productSlug" placeholder="tu-dong-tao-tu-ten"
              style="font-family:monospace;font-size:0.82rem"></div>
          <div class="form-group"><label>Meta Title</label><input id="productMetaTitle"
              placeholder="ƒê·ªÉ tr·ªëng = d√πng t√™n s·∫£n ph·∫©m"></div>
          <div class="form-group"><label>Meta Description</label><textarea id="productMetaDesc" rows="2"
              placeholder="ƒê·ªÉ tr·ªëng = d√πng m√¥ t·∫£ ng·∫Øn"></textarea></div>
          <div class="seo-preview" id="seoPreview">
            <div class="seo-title" id="seoPreviewTitle">T√™n s·∫£n ph·∫©m - BloomStore</div>
            <div class="seo-url" id="seoPreviewUrl">bloomstore.vn/san-pham/slug</div>
            <div class="seo-desc" id="seoPreviewDesc">M√¥ t·∫£ s·∫£n ph·∫©m s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" style="background:var(--bg-secondary);color:var(--text-secondary)"
          onclick="closeModal('productModal')">H·ªßy</button>
        <button class="btn btn-primary" onclick="saveProduct()">L∆∞u</button>
      </div>
    </div>
  </div>

  <!-- Category Modal -->
  <div class="modal-overlay" id="categoryModal">
    <div class="modal" style="width:450px">
      <div class="modal-header">
        <h3 id="categoryModalTitle">Th√™m danh m·ª•c</h3>
        <button class="modal-close" onclick="closeModal('categoryModal')">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="categoryId">
        <div class="form-group"><label>Slug</label><input id="categorySlug" placeholder="wedding"></div>
        <div class="form-group"><label>T√™n</label><input id="categoryName" placeholder="Hoa c∆∞·ªõi"></div>
        <div class="form-group"><label>M√¥ t·∫£</label><textarea id="categoryDesc"></textarea></div>
      </div>
      <div class="modal-footer">
        <button class="btn" style="background:var(--bg-secondary);color:var(--text-secondary)"
          onclick="closeModal('categoryModal')">H·ªßy</button>
        <button class="btn btn-primary" onclick="saveCategory()">L∆∞u</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    const API = window.location.origin;
    let token = localStorage.getItem('bs_token') || '';
    let categories = [];
    let products = [];

    // ========== AUTH ==========
    function checkAuth() {
      if (token) {
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
        loadDashboard();
      }
    }

    async function doLogin() {
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      try {
        const res = await fetch(`${API}/api/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        if (!res.ok) throw new Error();
        const data = await res.json();
        token = data.access_token;
        localStorage.setItem('bs_token', token);
        checkAuth();
      } catch {
        document.getElementById('loginError').style.display = 'block';
      }
    }

    function doLogout() {
      token = '';
      localStorage.removeItem('bs_token');
      document.getElementById('loginOverlay').style.display = 'flex';
      document.getElementById('app').style.display = 'none';
    }

    // ========== NAV ==========
    const pageTitles = { dashboard: 'Dashboard', products: 'S·∫£n ph·∫©m', categories: 'Danh m·ª•c', reviews: 'ƒê√°nh gi√°', gallery: 'B·ªô s∆∞u t·∫≠p', settings: 'C√†i ƒë·∫∑t', password: 'ƒê·ªïi m·∫≠t kh·∫©u' };
    function showPage(page) {
      document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
      const el = document.getElementById('page-' + page);
      if (el) { el.classList.add('active'); el.style.animation = 'none'; el.offsetHeight; el.style.animation = ''; }
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      if (event && event.currentTarget) event.currentTarget.classList.add('active');
      document.getElementById('currentPageTitle').textContent = pageTitles[page] || page;
      if (page === 'dashboard') loadDashboard();
      if (page === 'products') loadProducts();
      if (page === 'categories') loadCategories();
      if (page === 'reviews') loadReviews();
      if (page === 'settings') loadSettings();
    }

    // ========== SIDEBAR TOGGLE ==========
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('collapsed');
    }

    // ========== WELCOME DATE ==========
    function updateWelcomeDate() {
      const now = new Date();
      const days = ['Ch·ªß nh·∫≠t', 'Th·ª© hai', 'Th·ª© ba', 'Th·ª© t∆∞', 'Th·ª© nƒÉm', 'Th·ª© s√°u', 'Th·ª© b·∫£y'];
      const months = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'];
      const el = document.getElementById('welcomeDate');
      if (el) el.textContent = `${days[now.getDay()]}, ${now.getDate()}/${months[now.getMonth()]}/${now.getFullYear()} ‚Ä¢ Ch√∫c b·∫°n m·ªôt ng√†y l√†m vi·ªác hi·ªáu qu·∫£!`;
    }

    // ========== API helpers ==========
    function authHeaders() {
      return { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` };
    }

    /** Escape HTML to prevent XSS when using innerHTML */
    function esc(str) {
      if (str == null) return '';
      const div = document.createElement('div');
      div.appendChild(document.createTextNode(String(str)));
      return div.innerHTML;
    }

    async function apiFetch(url, opts = {}) {
      const res = await fetch(API + url, { ...opts, headers: { ...authHeaders(), ...opts.headers } });
      if (res.status === 401) { doLogout(); throw new Error('Unauthorized'); }
      return res;
    }

    function formatPrice(n) {
      return new Intl.NumberFormat('vi-VN').format(n) + ' ‚Ç´';
    }

    function starsHtml(rating) {
      let s = '';
      for (let i = 0; i < 5; i++) s += `<i class="fas fa-star" style="color:${i < rating ? '#f0c040' : '#555'}"></i>`;
      return s;
    }

    function showToast(msg, type = 'success') {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.className = `toast toast-${type} show`;
      setTimeout(() => t.classList.remove('show'), 3000);
    }

    function closeModal(id) { document.getElementById(id).classList.remove('show'); }

    // ========== DASHBOARD ==========
    async function loadDashboard() {
      updateWelcomeDate();
      try {
        const [prodRes, catRes] = await Promise.all([
          apiFetch('/api/products'), apiFetch('/api/categories')
        ]);
        products = await prodRes.json();
        categories = await catRes.json();

        document.getElementById('statProducts').textContent = products.length;
        document.getElementById('statCategories').textContent = categories.length;

        let totalReviews = 0, totalPrice = 0;
        products.forEach(p => { totalReviews += p.reviewCount || 0; totalPrice += Number(p.price); });
        document.getElementById('statReviews').textContent = totalReviews;
        document.getElementById('statAvgPrice').textContent = products.length ? new Intl.NumberFormat('vi-VN').format(Math.round(totalPrice / products.length)) : '0';

        // Update review badge
        const badge = document.getElementById('reviewBadge');
        if (badge && totalReviews > 0) { badge.textContent = totalReviews; badge.style.display = 'inline'; }

        const tbody = document.getElementById('dashboardProducts');
        tbody.innerHTML = products.slice(0, 5).map(p => `<tr>
      <td><img src="${p.images?.[0]?.url || ''}" alt="${p.name}"></td>
      <td><strong>${p.name}</strong></td>
      <td>${p.category?.name || '-'}</td>
      <td>${formatPrice(p.price)}</td>
      <td>${starsHtml(p.rating)}</td>
    </tr>`).join('');
      } catch (e) { console.error(e); }
    }

    // ========== PRODUCTS ==========
    async function loadProducts() {
      try {
        const [prodRes, catRes] = await Promise.all([apiFetch('/api/products'), apiFetch('/api/categories')]);
        products = await prodRes.json();
        categories = await catRes.json();

        const tbody = document.getElementById('productsTable');
        if (!products.length) { tbody.innerHTML = '<tr><td colspan="8"><div class="empty-state"><i class="fas fa-box-open"></i>Ch∆∞a c√≥ s·∫£n ph·∫©m</div></td></tr>'; return; }
        tbody.innerHTML = products.map(p => `<tr>
      <td><img src="${esc(p.images?.[0]?.url)}" alt="${esc(p.name)}"></td>
      <td><strong>${esc(p.name)}</strong><br><small style="color:var(--text-secondary)">${esc(p.shortDescription)}</small></td>
      <td><span class="badge badge-info">${esc(p.category?.name) || '-'}</span></td>
      <td><strong>${formatPrice(p.price)}</strong></td>
      <td>${p.originalPrice ? formatPrice(p.originalPrice) : '-'}</td>
      <td>${p.badge ? `<span class="badge badge-warning">${esc(p.badge)}</span>` : '-'}</td>
      <td>${starsHtml(p.rating)} <small>(${p.reviewCount})</small></td>
      <td>
        <button class="btn btn-sm btn-edit" onclick="editProduct(${p.id})"><i class="fas fa-edit"></i></button>
        <button class="btn btn-sm btn-delete" onclick="deleteProduct(${p.id})"><i class="fas fa-trash"></i></button>
      </td>
    </tr>`).join('');
        document.getElementById('productCount').textContent = `Hi·ªÉn th·ªã ${products.length} s·∫£n ph·∫©m`;
      } catch (e) { console.error(e); }
    }

    function filterProducts() {
      const q = document.getElementById('productSearch').value.toLowerCase();
      const rows = document.querySelectorAll('#productsTable tr');
      let count = 0;
      rows.forEach(r => {
        const match = r.textContent.toLowerCase().includes(q);
        r.style.display = match ? '' : 'none';
        if (match) count++;
      });
      document.getElementById('productCount').textContent = `Hi·ªÉn th·ªã ${count} s·∫£n ph·∫©m`;
    }

    // ========== IMAGE UPLOAD ==========
    let uploadedImages = []; // [{url, altText, originalName}]

    function setupUploadZone() {
      const zone = document.getElementById('uploadZone');
      const input = document.getElementById('fileInput');
      if (!zone || !input) return;

      input.addEventListener('change', e => handleFiles(e.target.files));

      zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
      zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
      zone.addEventListener('drop', e => {
        e.preventDefault();
        zone.classList.remove('drag-over');
        handleFiles(e.dataTransfer.files);
      });
    }

    async function handleFiles(files) {
      if (!files.length) return;
      const progress = document.getElementById('uploadProgress');
      progress.textContent = `ƒêang t·∫£i l√™n ${files.length} ·∫£nh...`;

      const formData = new FormData();
      for (const f of files) formData.append('files', f);

      try {
        const res = await fetch(API + '/api/upload', {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${token}` },
          body: formData,
        });
        if (!res.ok) throw new Error();
        const data = await res.json();

        for (const f of data.files) {
          uploadedImages.push({ url: f.url, altText: '', originalName: f.originalName });
        }
        renderImagePreviews();
        progress.textContent = `‚úì ${data.files.length} ·∫£nh ƒë√£ t·∫£i l√™n (WebP)`;
        setTimeout(() => progress.textContent = '', 3000);
      } catch (e) {
        progress.textContent = '‚ùå L·ªói t·∫£i ·∫£nh';
        showToast('L·ªói t·∫£i ·∫£nh', 'error');
      }
      document.getElementById('fileInput').value = '';
    }

    function renderImagePreviews() {
      const list = document.getElementById('imagePreviewList');
      list.innerHTML = uploadedImages.map((img, i) => `
        <div class="image-preview-item">
          <img src="${img.url}" alt="${img.altText || ''}">
          <button class="remove-img" onclick="removeImage(${i})">&times;</button>
          <span class="img-badge">WebP</span>
        </div>
      `).join('');
    }

    function removeImage(index) {
      uploadedImages.splice(index, 1);
      renderImagePreviews();
    }

    function updateSeoPreview() {
      const name = document.getElementById('productName')?.value || 'T√™n s·∫£n ph·∫©m';
      const metaTitle = document.getElementById('productMetaTitle')?.value;
      const slug = document.getElementById('productSlug')?.value || 'slug';
      const metaDesc = document.getElementById('productMetaDesc')?.value || document.getElementById('productShortDesc')?.value || 'M√¥ t·∫£ s·∫£n ph·∫©m...';
      document.getElementById('seoPreviewTitle').textContent = (metaTitle || name) + ' - BloomStore';
      document.getElementById('seoPreviewUrl').textContent = `bloomstore.vn/san-pham/${slug}`;
      document.getElementById('seoPreviewDesc').textContent = metaDesc.substring(0, 160);
    }

    function openProductModal(product = null) {
      document.getElementById('productModalTitle').textContent = product ? 'S·ª≠a s·∫£n ph·∫©m' : 'Th√™m s·∫£n ph·∫©m';
      document.getElementById('productId').value = product?.id || '';
      document.getElementById('productName').value = product?.name || '';
      document.getElementById('productBadge').value = product?.badge || '';
      document.getElementById('productPrice').value = product?.price || '';
      document.getElementById('productOriginalPrice').value = product?.originalPrice || '';
      document.getElementById('productShortDesc').value = product?.shortDescription || '';
      document.getElementById('productLongDesc').value = product?.longDescription || '';
      document.getElementById('productFeatures').value = (product?.features || []).join('\n');
      document.getElementById('productOccasions').value = (product?.occasions || []).join(', ');

      // SEO fields
      document.getElementById('productSlug').value = product?.slug || '';
      document.getElementById('productMetaTitle').value = product?.metaTitle || '';
      document.getElementById('productMetaDesc').value = product?.metaDescription || '';

      // Images
      uploadedImages = (product?.images || []).map(img => ({ url: img.url, altText: img.altText || '', originalName: '' }));
      renderImagePreviews();

      // Populate category dropdown
      const sel = document.getElementById('productCategory');
      sel.innerHTML = categories.map(c => `<option value="${c.id}" ${product?.categoryId === c.id ? 'selected' : ''}>${esc(c.name)}</option>`).join('');

      // Live SEO preview
      updateSeoPreview();
      ['productName', 'productSlug', 'productMetaTitle', 'productMetaDesc', 'productShortDesc'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', updateSeoPreview);
      });

      setupUploadZone();
      document.getElementById('productModal').classList.add('show');
    }

    async function editProduct(id) {
      try {
        const res = await apiFetch(`/api/products/${id}`);
        const product = await res.json();
        openProductModal(product);
      } catch (e) { showToast('L·ªói t·∫£i s·∫£n ph·∫©m', 'error'); }
    }

    async function saveProduct() {
      const id = document.getElementById('productId').value;
      const body = {
        name: document.getElementById('productName').value,
        slug: document.getElementById('productSlug').value || undefined,
        categoryId: parseInt(document.getElementById('productCategory').value),
        badge: document.getElementById('productBadge').value || undefined,
        price: parseInt(document.getElementById('productPrice').value),
        originalPrice: parseInt(document.getElementById('productOriginalPrice').value) || undefined,
        shortDescription: document.getElementById('productShortDesc').value,
        longDescription: document.getElementById('productLongDesc').value,
        imageUrls: uploadedImages.map(i => i.url),
        imageAlts: uploadedImages.map(i => i.altText || document.getElementById('productName').value),
        features: document.getElementById('productFeatures').value.split('\n').map(s => s.trim()).filter(Boolean),
        occasions: document.getElementById('productOccasions').value.split(',').map(s => s.trim()).filter(Boolean),
        metaTitle: document.getElementById('productMetaTitle').value || undefined,
        metaDescription: document.getElementById('productMetaDesc').value || undefined,
      };

      try {
        await apiFetch(id ? `/api/products/${id}` : '/api/products', {
          method: id ? 'PATCH' : 'POST',
          body: JSON.stringify(body)
        });
        closeModal('productModal');
        showToast(id ? 'ƒê√£ c·∫≠p nh·∫≠t s·∫£n ph·∫©m' : 'ƒê√£ th√™m s·∫£n ph·∫©m');
        loadProducts();
      } catch (e) { showToast('L·ªói l∆∞u s·∫£n ph·∫©m', 'error'); }
    }

    async function deleteProduct(id) {
      if (!confirm('X√≥a s·∫£n ph·∫©m n√†y?')) return;
      try {
        await apiFetch(`/api/products/${id}`, { method: 'DELETE' });
        showToast('ƒê√£ x√≥a s·∫£n ph·∫©m');
        loadProducts();
      } catch (e) { showToast('L·ªói x√≥a', 'error'); }
    }

    // ========== CATEGORIES ==========
    async function loadCategories() {
      try {
        const res = await apiFetch('/api/categories');
        categories = await res.json();
        const tbody = document.getElementById('categoriesTable');
        if (!categories.length) { tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-tags"></i>Ch∆∞a c√≥ danh m·ª•c</div></td></tr>'; return; }
        tbody.innerHTML = categories.map(c => `<tr>
      <td>${c.id}</td>
      <td><code>${esc(c.slug)}</code></td>
      <td><strong>${esc(c.name)}</strong></td>
      <td>${esc(c.description) || '-'}</td>
      <td>
        <button class="btn btn-sm btn-edit" onclick="editCategory(${c.id})"><i class="fas fa-edit"></i></button>
        <button class="btn btn-sm btn-delete" onclick="deleteCategory(${c.id})"><i class="fas fa-trash"></i></button>
      </td>
    </tr>`).join('');
      } catch (e) { console.error(e); }
    }

    function openCategoryModal(cat = null) {
      document.getElementById('categoryModalTitle').textContent = cat ? 'S·ª≠a danh m·ª•c' : 'Th√™m danh m·ª•c';
      document.getElementById('categoryId').value = cat?.id || '';
      document.getElementById('categorySlug').value = cat?.slug || '';
      document.getElementById('categoryName').value = cat?.name || '';
      document.getElementById('categoryDesc').value = cat?.description || '';
      document.getElementById('categoryModal').classList.add('show');
    }

    async function editCategory(id) {
      const cat = categories.find(c => c.id === id);
      if (cat) openCategoryModal(cat);
    }

    async function saveCategory() {
      const id = document.getElementById('categoryId').value;
      const body = {
        slug: document.getElementById('categorySlug').value,
        name: document.getElementById('categoryName').value,
        description: document.getElementById('categoryDesc').value,
      };
      try {
        await apiFetch(id ? `/api/categories/${id}` : '/api/categories', {
          method: id ? 'PATCH' : 'POST',
          body: JSON.stringify(body)
        });
        closeModal('categoryModal');
        showToast(id ? 'ƒê√£ c·∫≠p nh·∫≠t danh m·ª•c' : 'ƒê√£ th√™m danh m·ª•c');
        loadCategories();
      } catch (e) { showToast('L·ªói l∆∞u danh m·ª•c', 'error'); }
    }

    async function deleteCategory(id) {
      if (!confirm('X√≥a danh m·ª•c n√†y?')) return;
      try {
        await apiFetch(`/api/categories/${id}`, { method: 'DELETE' });
        showToast('ƒê√£ x√≥a danh m·ª•c');
        loadCategories();
      } catch (e) { showToast('L·ªói x√≥a', 'error'); }
    }

    // ========== REVIEWS ==========
    async function loadReviews() {
      try {
        const prodRes = await apiFetch('/api/products');
        const prods = await prodRes.json();
        let allReviews = [];
        for (const p of prods) {
          const res = await apiFetch(`/api/reviews?productId=${p.id}`);
          const reviews = await res.json();
          reviews.forEach(r => { r._productName = p.name; });
          allReviews = allReviews.concat(reviews);
        }

        const tbody = document.getElementById('reviewsTable');
        if (!allReviews.length) { tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><i class="fas fa-star"></i>Ch∆∞a c√≥ ƒë√°nh gi√°</div></td></tr>'; return; }
        tbody.innerHTML = allReviews.map(r => `<tr>
      <td>${esc(r._productName)}</td>
      <td><strong>${esc(r.reviewerName)}</strong>${r.verified ? ' <i class="fas fa-check-circle" style="color:var(--success);font-size:0.75rem"></i>' : ''}</td>
      <td>${starsHtml(r.rating)}</td>
      <td style="max-width:300px">${esc(r.comment) || '-'}</td>
      <td>${new Date(r.reviewDate).toLocaleDateString('vi-VN')}</td>
      <td><button class="btn btn-sm btn-delete" onclick="deleteReview(${r.id})"><i class="fas fa-trash"></i></button></td>
    </tr>`).join('');
        document.getElementById('reviewCount').textContent = `Hi·ªÉn th·ªã ${allReviews.length} ƒë√°nh gi√°`;
      } catch (e) { console.error(e); }
    }

    function filterReviews() {
      const q = document.getElementById('reviewSearch').value.toLowerCase();
      const rows = document.querySelectorAll('#reviewsTable tr');
      let count = 0;
      rows.forEach(r => {
        const match = r.textContent.toLowerCase().includes(q);
        r.style.display = match ? '' : 'none';
        if (match) count++;
      });
      document.getElementById('reviewCount').textContent = `Hi·ªÉn th·ªã ${count} ƒë√°nh gi√°`;
    }

    async function deleteReview(id) {
      if (!confirm('X√≥a ƒë√°nh gi√° n√†y?')) return;
      try {
        await apiFetch(`/api/reviews/${id}`, { method: 'DELETE' });
        showToast('ƒê√£ x√≥a ƒë√°nh gi√°');
        loadReviews();
      } catch (e) { showToast('L·ªói x√≥a', 'error'); }
    }

    // ========== SETTINGS ==========
    const SETTING_KEYS = ['shop_name', 'slogan', 'logo_url', 'favicon_url', 'meta_title', 'meta_description', 'meta_keywords', 'og_image', 'phone', 'email', 'address', 'google_map_url', 'zalo_url', 'facebook_url', 'instagram_url'];

    async function loadSettings() {
      try {
        const res = await apiFetch('/api/settings');
        const settings = await res.json();
        SETTING_KEYS.forEach(key => {
          const el = document.getElementById('setting_' + key);
          if (el) el.value = settings[key] || '';
        });
      } catch (e) { console.error(e); }
    }

    async function changePassword() {
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      if (!currentPassword || !newPassword || !confirmPassword) {
        showToast('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin', 'error');
        return;
      }
      if (newPassword.length < 6) {
        showToast('M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±', 'error');
        return;
      }
      if (newPassword !== confirmPassword) {
        showToast('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp', 'error');
        return;
      }
      try {
        const res = await apiFetch('/api/auth/change-password', {
          method: 'PUT',
          body: JSON.stringify({ currentPassword, newPassword, confirmPassword })
        });
        if (!res.ok) {
          const err = await res.json();
          showToast(err.message || 'L·ªói ƒë·ªïi m·∫≠t kh·∫©u', 'error');
          return;
        }
        showToast('ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!');
        document.getElementById('currentPassword').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmPassword').value = '';
      } catch (e) { showToast('L·ªói ƒë·ªïi m·∫≠t kh·∫©u', 'error'); }
    }

    async function saveSettings() {
      const settings = SETTING_KEYS.map(key => ({
        key,
        value: document.getElementById('setting_' + key)?.value || ''
      }));
      try {
        await apiFetch('/api/settings', {
          method: 'PUT',
          body: JSON.stringify({ settings })
        });
        showToast('ƒê√£ l∆∞u c√†i ƒë·∫∑t th√†nh c√¥ng');
      } catch (e) { showToast('L·ªói l∆∞u c√†i ƒë·∫∑t', 'error'); }
    }

    // Init
    document.addEventListener('keydown', e => { if (e.key === 'Enter' && document.getElementById('loginOverlay').style.display !== 'none') doLogin(); });
    checkAuth();
  </script>
</body>

</html>